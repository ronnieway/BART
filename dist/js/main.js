'use strict';(function(c,$){'use strict';var f=0,g=$('head'),l=c.BigText,o=$.fn.bigtext,p={DEBUG_MODE:!1,DEFAULT_MIN_FONT_SIZE_PX:null,DEFAULT_MAX_FONT_SIZE_PX:528,GLOBAL_STYLE_ID:'bigtext-style',STYLE_ID:'bigtext-id',LINE_CLASS_PREFIX:'bigtext-line',EXEMPT_CLASS:'bigtext-exempt',noConflict:q=>{if(q){$.fn.bigtext=o;c.BigText=l}return p},test:{wholeNumberFontSizeOnly:()=>{if(!('getComputedStyle'in c)||document.body==null){return!0}var q=$('<div/>').css({position:'absolute','font-size':'14.1px'}).appendTo(document.body).get(0),r=c.getComputedStyle(q,null);if(r){return r.getPropertyValue('font-size')==='14px'}return!0}},supports:{wholeNumberFontSizeOnly:void 0},init:()=>{if(p.supports.wholeNumberFontSizeOnly===void 0){p.supports.wholeNumberFontSizeOnly=p.test.wholeNumberFontSizeOnly()}if(!$('#'+p.GLOBAL_STYLE_ID).length){g.append(p.generateStyleTag(p.GLOBAL_STYLE_ID,['.bigtext * { white-space: nowrap; } .bigtext > * { display: block; }','.bigtext .'+p.EXEMPT_CLASS+', .bigtext .'+p.EXEMPT_CLASS+' * { white-space: normal; }']))}},bindResize:(q,r)=>{if($.throttle){$(c).unbind(q).bind(q,$.throttle(100,r))}else{if($.fn.smartresize){q='smartresize.'+q}$(c).unbind(q).bind(q,r)}},getStyleId:id=>p.STYLE_ID+'-'+id,generateStyleTag:(id,css)=>$('<style>'+css.join('\n')+'</style>').attr('id',id),clearCss:q=>{var r=p.getStyleId(q);$('#'+r).remove()},generateCss:(q,r,s,t)=>{var u=[];p.clearCss(q);for(var j=0,k=r.length;j<k;j++){u.push('#'+q+' .'+p.LINE_CLASS_PREFIX+j+' {'+(t[j]?' white-space: normal;':'')+(r[j]?' font-size: '+r[j]+'px;':'')+(s[j]?' word-spacing: '+s[j]+'px;':'')+'}')}return p.generateStyleTag(p.getStyleId(q),u)},jQueryMethod:function q(r){p.init();r=$.extend({minfontsize:p.DEFAULT_MIN_FONT_SIZE_PX,maxfontsize:p.DEFAULT_MAX_FONT_SIZE_PX,childSelector:'',resize:!0},r||{});this.each(function(){var s=$(this).addClass('bigtext'),t=s.width(),u=s.attr('id'),v=r.childSelector?s.find(r.childSelector):s.children();if(!u){u='bigtext-id'+f++;s.attr('id',u)}if(r.resize){p.bindResize('resize.bigtext-event-'+u,()=>{p.jQueryMethod.call($('#'+u),r)})}p.clearCss(u);v.addClass((lineNumber,className)=>[className.replace(new RegExp('\\b'+p.LINE_CLASS_PREFIX+'\\d+\\b'),''),p.LINE_CLASS_PREFIX+lineNumber].join(' '));var w=e(s,v,t,r.maxfontsize,r.minfontsize);g.append(p.generateCss(u,w.fontSizes,w.wordSpacings,w.minFontSizes))});return this.trigger('bigtext:complete')}};function d(q,r,s,t,u,v,w){var y;w=typeof w=='number'?w:0;q.css(s,t+v);y=q.width();if(y>=r){q.css(s,'');if(y===r){return{match:'exact',size:parseFloat((parseFloat(t)-0.1).toFixed(3))}}var z=r-w,A=y-r;return{match:'estimate',size:parseFloat((parseFloat(t)-(s==='word-spacing'&&w&&A<z?0:u)).toFixed(3))}}return y}function e(q,r,s,t,u){var v=q.clone(!0).addClass('bigtext-cloned').css({fontFamily:q.css('font-family'),textTransform:q.css('text-transform'),wordSpacing:q.css('word-spacing'),letterSpacing:q.css('letter-spacing'),position:'absolute',left:p.DEBUG_MODE?0:-9999,top:p.DEBUG_MODE?0:-9999}).appendTo(document.body),w=[],y=[],z=[],A=[];r.css('float','left').each(function(){var B=$(this),C=p.supports.wholeNumberFontSizeOnly?[8,4,1]:[8,4,1,0.1],D,E;if(B.hasClass(p.EXEMPT_CLASS)){w.push(null);A.push(null);z.push(!1);return}var F=32,G=parseFloat(B.css('font-size')),H=(B.width()/G).toFixed(6);E=parseInt(s/H,10)-F;outer:for(var m=0,n=C.length;m<n;m++){inner:for(var j=1,k=10;j<=k;j++){if(E+j*C[m]>t){E=t;break outer}D=d(B,s,'font-size',E+j*C[m],C[m],'px',D);if(typeof D!='number'){E=D.size;if(D.match==='exact'){break outer}break inner}}}A.push(s/E);if(E>t){w.push(t);z.push(!1)}else if(!!u&&E<u){w.push(u);z.push(!0)}else{w.push(E);z.push(!1)}}).each(function(B){var C=$(this),D=0,E=1,F;if(C.hasClass(p.EXEMPT_CLASS)){y.push(null);return}C.css('font-size',w[B]+'px');for(var m=1,n=3;m<n;m+=E){F=d(C,s,'word-spacing',m,E,'px',F);if(typeof F!='number'){D=F.size;break}}C.css('font-size','');y.push(D)}).removeAttr('style');if(!p.DEBUG_MODE){v.remove()}else{v.css({'background-color':'rgba(255,255,255,.4)'})}return{fontSizes:w,wordSpacings:y,ratios:A,minFontSizes:z}}$.fn.bigtext=p.jQueryMethod;c.BigText=p})(void 0,jQuery);$('#bigtext').bigtext();if('serviceWorker'in navigator){navigator.serviceWorker.register('/swGetData.js').then(c=>{console.log('ServiceWorker registration',c)}).catch(c=>{throw new Error('ServiceWorker error: '+c)})}function loadData(){var d='http://api.bart.gov/api/stn.aspx?cmd=stns&key=MW9S-E7SL-26DU-VV8V';$.ajax({type:'GET',url:d,dataType:'xml',success:c,error:()=>{$('#routes-at-station-header').css('color','red').html('You are offline!');$('#routes-at-station-values').css('color','red').html('You can\'t get the actual information regarding your trip, but you still have a chance to chek the offline schedule for the chosen station')}});function c(e){$('#stations-list').html('');$(e).find('station').each(function(){$('#stations-list').append('<option value=\''+$(this).find('name').text()+'\' data-value=\''+$(this).find('abbr').text()+'\'></option>');$('#stations-list2').append('<option value=\''+$(this).find('name').text()+'\' data-value=\''+$(this).find('abbr').text()+'\'></option>')})}return!1}function chooseStation(){var d=$('#stations-input').val(),e=$('#stations-list option[value=\''+d+'\']').attr('data-value'),f='http://api.bart.gov/api/stn.aspx?cmd=stninfo&key=MW9S-E7SL-26DU-VV8V&orig='+e;$.ajax({type:'GET',url:f,dataType:'xml',success:data=>data,complete:c,error:()=>{$('#routes-at-station-header').css('color','red').html('You are offline!');$('#routes-at-station-values').css('color','red').html('You can\'t get the actual information regarding your trip, but you still have a chance to chek the offline schedule for the chosen station');$('#all-schedule-content').html('')}});function c(g){$('#form-container2').css('display','block');$('#routes-at-station-values').html('');$('#routes-at-station-header').html('<p>Choose route</p>');$('#stations-input2').val('');$('#all-schedule-content').html('');$('#sched-results').html('');var a=$(g.responseText).find('station').find('north_routes').find('route').text(),b=$(g.responseText).find('station').find('south_routes').find('route').text();a=a.replace(/\s/g,'');b=b.replace(/\s/g,'');var l=a.split('ROUTE').slice(2),o=b.split('ROUTE').slice(2);$('#routes-at-station-header').html('Routes at the station:').css('color','white');for(var i=0;i<l.length;i++){$('#routes-at-station-values').append('<div class=\'col-xs-6 col-sm-6 col-md-5 col-lg-5\' id=\'route'+l[i]+'\'><b><a onclick=\'chooseRoute('+l[i]+');\'>Route '+l[i]+'</a></b></div>')}for(var j=0;j<o.length;j++){$('#routes-at-station-values').append('<div class=\'col-xs-6 col-sm-6 col-md-5 col-lg-5\' id=\'route'+o[j]+'\'><b><a onclick=\'chooseRoute('+o[j]+');\'>Route '+o[j]+'</a></b></div>')}}$.ajax({type:'GET',url:'http://api.bart.gov/api/sched.aspx?cmd=stnsched&key=MW9S-E7SL-26DU-VV8V&l=1&orig='+e,dataType:'xml',success:$('#all-schedule-link').html('<button type=\'button\' class=\'btn btn-primary btn-lg btn-block\' id=\'offline-sched\'>Offline schedule for '+d+'</button>'),error:()=>{$('#form-container2').css('display','none');$('#routes-at-station-header').css('color','red').html('You are offline!');$('#routes-at-station-values').css('color','red').html('You can\'t get the actual information regarding your trip, but you still have a chance to chek the offline schedule for the chosen station');$('#all-schedule-content').html('')}});return!1}function chooseRoute(x){var d='http://api.bart.gov/api/route.aspx?cmd=routeinfo&key=MW9S-E7SL-26DU-VV8V&route='+x;$.ajax({type:'GET',url:d,dataType:'xml',success:c,error:()=>{$('#form-container2').css('display','none');$('#routes-at-station-header').css('color','red').html('You are offline!');$('#routes-at-station-values').css('color','red').html('You can\'t get the actual information regarding your trip, but you still have a chance to chek the offline schedule for the chosen station');$('#all-schedule-content').html('')}});function c(e){$('#routes-at-station-header').html('<p>Select the destination at the chosen route</p>').css('color','white');var b='#route'+x,a=$(e).find('station').text();a=a.match(/.{4}/g);$('#all-schedule-content').html('');var f=$('#stations-input').val();for(var i=0;i<a.length;i++){var g='finalDestination(\''+a[i]+'\')';if($('#stations-list option[data-value=\''+a[i]+'\']').attr('value')!=void 0){if(a[i]==$('#stations-list option[value=\''+f+'\']').attr('data-value')){$(b).append('<p class=\'you-are-here\'> You are here: '+$('#stations-list option[data-value=\''+a[i]+'\']').attr('value')+'</p>')}else{$(b).append('<p><a onclick='+g+';>'+$('#stations-list option[data-value=\''+a[i]+'\']').attr('value')+'</a></p>')}}}}return!1}function finalDestination(c){var e=$('#stations-input').val(),f=$('#stations-list option[value=\''+e+'\']').attr('data-value'),g='http://api.bart.gov/api/sched.aspx?cmd=arrive&date=now&key=MW9S-E7SL-26DU-VV8V&b=0&a=3&orig='+f+'&dest='+c;$.ajax({type:'GET',url:g,dataType:'xml',success:d,error:()=>{$('#form-container2').css('display','none');$('#routes-at-station-header').css('color','red').html('You are offline!');$('#routes-at-station-values').css('color','red').html('You can\'t get the actual information regarding your trip, but you still have a chance to chek the offline schedule for the chosen station');$('#all-schedule-content').html('')}});function d(l){$('#sched-results').html('');$('#all-schedule-content').html('');$('#routes-at-station-values').html('');$('#routes-at-station-header').html('');$('#sched-results').append('<h4 class=\'suggestedTime\'>You can pick one of the following trains to '+$('#stations-list option[data-value=\''+c+'\']').attr('value')+'</h4>');$(l).find('trip').each(function(){var o=this.children[1].outerHTML.split('origTimeMin='),p=o[1].slice(1,9),q=this.children[1].outerHTML.split('destTimeMin='),r=q[1].slice(1,9);if(p[7]=='"'){p=p.slice(0,-1)}if(r[7]=='"'){r=r.slice(0,-1)}$('#sched-results').append('<p class=\'suggestedTime\'>Departure: '+p+', arrival: '+r+'</p>')})}return!1}function finalDestination2(){var d=$('#stations-input').val(),e=$('#stations-list option[value=\''+d+'\']').attr('data-value'),f=$('#stations-input2').val(),g=$('#stations-list2 option[value=\''+f+'\']').attr('data-value'),l='http://api.bart.gov/api/sched.aspx?cmd=arrive&date=now&key=MW9S-E7SL-26DU-VV8V&b=0&a=3&orig='+e+'&dest='+g;$.ajax({type:'GET',url:l,dataType:'xml',success:c,error:()=>{$('#form-container2').css('display','none');$('#routes-at-station-header').css('color','red').html('You are offline!');$('#routes-at-station-values').css('color','red').html('You can\'t get the actual information regarding your trip, but you still have a chance to chek the offline schedule for the chosen station');$('#all-schedule-content').html('')}});function c(o){var p=$('#stations-input2').val();$('#sched-results').html('');$('#all-schedule-content').html('');$('#routes-at-station-values').html('');$('#routes-at-station-header').html('');$('#sched-results').append('<div class=\'suggestedTime col-xs-12 col-sm-12 col-md-12 col-lg-12\'><h4 class=\'suggestedTime\'>You can pick one of the following trains to '+p+'</h4></div>');$(o).find('trip').each(function(){var q=this.children[1].outerHTML.split('origTimeMin='),r=q[1].slice(1,9),s=this.children[1].outerHTML.split('destTimeMin='),t=s[1].slice(1,9);if(r[7]=='"'){r=r.slice(0,-1)}if(t[7]=='"'){t=t.slice(0,-1)}$('#sched-results').append('<div class=\'suggestedTime col-xs-12 col-sm-12 col-md-12 col-lg-12\'>Departure: '+r+', arrival: '+t+'</div>')})}return!1}function showSchedule(){var d=$('#stations-input').val(),e=$('#stations-list option[value=\''+d+'\']').attr('data-value'),f=$('#stations-list option[value=\''+d+'\']').attr('value');$.ajax({type:'GET',url:'http://api.bart.gov/api/sched.aspx?cmd=stnsched&key=MW9S-E7SL-26DU-VV8V&l=1&orig='+e,dataType:'xml',success:c,error:()=>{$('#form-container2').css('display','none');$('#routes-at-station-header').css('color','red').html('You are offline!');$('#routes-at-station-values').css('color','red').html('You can\'t get the actual information regarding your trip, but you still have a chance to chek the offline schedule for the chosen station');$('#all-schedule-content').html('');$('#all-schedule-content').append('<h4 class=\'text-center\'>Sorry, schedule wasn\'t loaded. Here is routes map.</h4>').css('color','red');$('#all-schedule-content').append('<img id=\'the-routes-map\' src=\'img/map.gif\'>')}});function c(g){$('#routes-at-station-header').html('');$('#routes-at-station-values').html('');$('#all-schedule-content').html('');$('#sched-results').html('');var l=$('#stations-input').val(),o=$('#stations-list option[value=\''+l+'\']').attr('data-value');$('#all-schedule-link').html('<button type=\'button\' class=\'btn btn-primary btn-lg btn-block\' id=\'offline-sched\'>Offline schedule for '+f+'</button>');var p=g.children[0].innerHTML;p=p.split('<item line=').slice(1);var q='<table class=\'table table-hover table-responsive table-striped\' id=\'sched-table\'><thead class=\'center\'><tr class=\'row\'><th class=\'col-xs-3 col-sm-3 col-md-3 col-lg-3\'>Route</th><th class=\'col-xs-3 col-sm-3 col-md-3 col-lg-3\'>Destination</th><th class=\'col-xs-3 col-sm-3 col-md-3 col-lg-3\'>Departure time</th><th class=\'col-xs-3 col-sm-3 col-md-3 col-lg-3\'>Arrival time</th></tr></thead><tbody>';for(var h=0;h<p.length;h++){var r=p[h].slice(7,9);if(r[1]=='"'){r=r.slice(0,-1)}var s=p[h].split('trainHeadStation='),t=s[1].slice(1,5),u=$('#stations-list option[data-value=\''+t+'\']').attr('value'),v=p[h].split('origTime='),w=v[1].slice(1,9);if(w[7]=='"'){w=w.slice(0,-1)}var y=p[h].split('destTime='),z=y[1].slice(1,9);if(z[7]=='"'){z=z.slice(0,-1)}q=q+'<tr class=\'row\'><td class=\'col-xs-3 col-sm-3 col-md-3 col-lg-3\'>'+r+'</td><td class=\'col-xs-3 col-sm-3 col-md-3 col-lg-3\'>'+u+'</td><td class=\'col-xs-3 col-sm-3 col-md-3 col-lg-3\'>'+w+'</td><td class=\'col-xs-3 col-sm-3 col-md-3 col-lg-3\'>'+z+'</td></tr>'}q=q+'</tbody></table>';$('#all-schedule-content').append(q)}}$('#form-container').submit(chooseStation);$('#form-container2').submit(finalDestination2);$('#all-schedule-link').click(showSchedule);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJtYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuLy8tIGluamVjdDpwYXJ0c1xuLyohIEJpZ1RleHQgLSB2MC4xLjdhIC0gMjAxNC0wNy0xOFxyXG4gKiBodHRwczovL2dpdGh1Yi5jb20vemFjaGxlYXQvYmlndGV4dFxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQgWmFjaCBMZWF0aGVybWFuIChAemFjaGxlYXQpXHJcbiAqIE1JVCBMaWNlbnNlICovXG5cbihmdW5jdGlvbiAod2luZG93LCAkKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIHZhciBjb3VudGVyID0gMCxcbiAgICAgICRoZWFkQ2FjaGUgPSAkKCdoZWFkJyksXG4gICAgICBvbGRCaWdUZXh0ID0gd2luZG93LkJpZ1RleHQsXG4gICAgICBvbGRqUXVlcnlNZXRob2QgPSAkLmZuLmJpZ3RleHQsXG4gICAgICBCaWdUZXh0ID0ge1xuICAgIERFQlVHX01PREU6IGZhbHNlLFxuICAgIERFRkFVTFRfTUlOX0ZPTlRfU0laRV9QWDogbnVsbCxcbiAgICBERUZBVUxUX01BWF9GT05UX1NJWkVfUFg6IDUyOCxcbiAgICBHTE9CQUxfU1RZTEVfSUQ6ICdiaWd0ZXh0LXN0eWxlJyxcbiAgICBTVFlMRV9JRDogJ2JpZ3RleHQtaWQnLFxuICAgIExJTkVfQ0xBU1NfUFJFRklYOiAnYmlndGV4dC1saW5lJyxcbiAgICBFWEVNUFRfQ0xBU1M6ICdiaWd0ZXh0LWV4ZW1wdCcsXG4gICAgbm9Db25mbGljdDogZnVuY3Rpb24gbm9Db25mbGljdChyZXN0b3JlKSB7XG4gICAgICBpZiAocmVzdG9yZSkge1xuICAgICAgICAkLmZuLmJpZ3RleHQgPSBvbGRqUXVlcnlNZXRob2Q7XG4gICAgICAgIHdpbmRvdy5CaWdUZXh0ID0gb2xkQmlnVGV4dDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBCaWdUZXh0O1xuICAgIH0sXG4gICAgdGVzdDoge1xuICAgICAgd2hvbGVOdW1iZXJGb250U2l6ZU9ubHk6IGZ1bmN0aW9uIHdob2xlTnVtYmVyRm9udFNpemVPbmx5KCkge1xuICAgICAgICBpZiAoISgnZ2V0Q29tcHV0ZWRTdHlsZScgaW4gd2luZG93KSB8fCBkb2N1bWVudC5ib2R5ID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgdGVzdCA9ICQoJzxkaXYvPicpLmNzcyh7XG4gICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgJ2ZvbnQtc2l6ZSc6ICcxNC4xcHgnXG4gICAgICAgIH0pLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmdldCgwKSxcbiAgICAgICAgICAgIGNvbXB1dGVkU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0ZXN0LCBudWxsKTtcblxuICAgICAgICBpZiAoY29tcHV0ZWRTdHlsZSkge1xuICAgICAgICAgIHJldHVybiBjb21wdXRlZFN0eWxlLmdldFByb3BlcnR5VmFsdWUoJ2ZvbnQtc2l6ZScpID09PSAnMTRweCc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSxcbiAgICBzdXBwb3J0czoge1xuICAgICAgd2hvbGVOdW1iZXJGb250U2l6ZU9ubHk6IHVuZGVmaW5lZFxuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIGlmIChCaWdUZXh0LnN1cHBvcnRzLndob2xlTnVtYmVyRm9udFNpemVPbmx5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgQmlnVGV4dC5zdXBwb3J0cy53aG9sZU51bWJlckZvbnRTaXplT25seSA9IEJpZ1RleHQudGVzdC53aG9sZU51bWJlckZvbnRTaXplT25seSgpO1xuICAgICAgfVxuXG4gICAgICBpZiAoISQoJyMnICsgQmlnVGV4dC5HTE9CQUxfU1RZTEVfSUQpLmxlbmd0aCkge1xuICAgICAgICAkaGVhZENhY2hlLmFwcGVuZChCaWdUZXh0LmdlbmVyYXRlU3R5bGVUYWcoQmlnVGV4dC5HTE9CQUxfU1RZTEVfSUQsIFsnLmJpZ3RleHQgKiB7IHdoaXRlLXNwYWNlOiBub3dyYXA7IH0gLmJpZ3RleHQgPiAqIHsgZGlzcGxheTogYmxvY2s7IH0nLCAnLmJpZ3RleHQgLicgKyBCaWdUZXh0LkVYRU1QVF9DTEFTUyArICcsIC5iaWd0ZXh0IC4nICsgQmlnVGV4dC5FWEVNUFRfQ0xBU1MgKyAnICogeyB3aGl0ZS1zcGFjZTogbm9ybWFsOyB9J10pKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGJpbmRSZXNpemU6IGZ1bmN0aW9uIGJpbmRSZXNpemUoZXZlbnROYW1lLCByZXNpemVGdW5jdGlvbikge1xuICAgICAgaWYgKCQudGhyb3R0bGUpIHtcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Nvd2JveS9qcXVlcnktdGhyb3R0bGUtZGVib3VuY2VcbiAgICAgICAgJCh3aW5kb3cpLnVuYmluZChldmVudE5hbWUpLmJpbmQoZXZlbnROYW1lLCAkLnRocm90dGxlKDEwMCwgcmVzaXplRnVuY3Rpb24pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICgkLmZuLnNtYXJ0cmVzaXplKSB7XG4gICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2xyYmFiZS9qcXVlcnktc21hcnRyZXNpemUvXG4gICAgICAgICAgZXZlbnROYW1lID0gJ3NtYXJ0cmVzaXplLicgKyBldmVudE5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgJCh3aW5kb3cpLnVuYmluZChldmVudE5hbWUpLmJpbmQoZXZlbnROYW1lLCByZXNpemVGdW5jdGlvbik7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRTdHlsZUlkOiBmdW5jdGlvbiBnZXRTdHlsZUlkKGlkKSB7XG4gICAgICByZXR1cm4gQmlnVGV4dC5TVFlMRV9JRCArICctJyArIGlkO1xuICAgIH0sXG4gICAgZ2VuZXJhdGVTdHlsZVRhZzogZnVuY3Rpb24gZ2VuZXJhdGVTdHlsZVRhZyhpZCwgY3NzKSB7XG4gICAgICByZXR1cm4gJCgnPHN0eWxlPicgKyBjc3Muam9pbignXFxuJykgKyAnPC9zdHlsZT4nKS5hdHRyKCdpZCcsIGlkKTtcbiAgICB9LFxuICAgIGNsZWFyQ3NzOiBmdW5jdGlvbiBjbGVhckNzcyhpZCkge1xuICAgICAgdmFyIHN0eWxlSWQgPSBCaWdUZXh0LmdldFN0eWxlSWQoaWQpO1xuICAgICAgJCgnIycgKyBzdHlsZUlkKS5yZW1vdmUoKTtcbiAgICB9LFxuICAgIGdlbmVyYXRlQ3NzOiBmdW5jdGlvbiBnZW5lcmF0ZUNzcyhpZCwgbGluZXNGb250U2l6ZXMsIGxpbmVXb3JkU3BhY2luZ3MsIG1pbkZvbnRTaXplcykge1xuICAgICAgdmFyIGNzcyA9IFtdO1xuXG4gICAgICBCaWdUZXh0LmNsZWFyQ3NzKGlkKTtcblxuICAgICAgZm9yICh2YXIgaiA9IDAsIGsgPSBsaW5lc0ZvbnRTaXplcy5sZW5ndGg7IGogPCBrOyBqKyspIHtcbiAgICAgICAgY3NzLnB1c2goJyMnICsgaWQgKyAnIC4nICsgQmlnVGV4dC5MSU5FX0NMQVNTX1BSRUZJWCArIGogKyAnIHsnICsgKG1pbkZvbnRTaXplc1tqXSA/ICcgd2hpdGUtc3BhY2U6IG5vcm1hbDsnIDogJycpICsgKGxpbmVzRm9udFNpemVzW2pdID8gJyBmb250LXNpemU6ICcgKyBsaW5lc0ZvbnRTaXplc1tqXSArICdweDsnIDogJycpICsgKGxpbmVXb3JkU3BhY2luZ3Nbal0gPyAnIHdvcmQtc3BhY2luZzogJyArIGxpbmVXb3JkU3BhY2luZ3Nbal0gKyAncHg7JyA6ICcnKSArICd9Jyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBCaWdUZXh0LmdlbmVyYXRlU3R5bGVUYWcoQmlnVGV4dC5nZXRTdHlsZUlkKGlkKSwgY3NzKTtcbiAgICB9LFxuICAgIGpRdWVyeU1ldGhvZDogZnVuY3Rpb24galF1ZXJ5TWV0aG9kKG9wdGlvbnMpIHtcbiAgICAgIEJpZ1RleHQuaW5pdCgpO1xuXG4gICAgICBvcHRpb25zID0gJC5leHRlbmQoe1xuICAgICAgICBtaW5mb250c2l6ZTogQmlnVGV4dC5ERUZBVUxUX01JTl9GT05UX1NJWkVfUFgsXG4gICAgICAgIG1heGZvbnRzaXplOiBCaWdUZXh0LkRFRkFVTFRfTUFYX0ZPTlRfU0laRV9QWCxcbiAgICAgICAgY2hpbGRTZWxlY3RvcjogJycsXG4gICAgICAgIHJlc2l6ZTogdHJ1ZVxuICAgICAgfSwgb3B0aW9ucyB8fCB7fSk7XG5cbiAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciAkdCA9ICQodGhpcykuYWRkQ2xhc3MoJ2JpZ3RleHQnKSxcbiAgICAgICAgICAgIG1heFdpZHRoID0gJHQud2lkdGgoKSxcbiAgICAgICAgICAgIGlkID0gJHQuYXR0cignaWQnKSxcbiAgICAgICAgICAgICRjaGlsZHJlbiA9IG9wdGlvbnMuY2hpbGRTZWxlY3RvciA/ICR0LmZpbmQob3B0aW9ucy5jaGlsZFNlbGVjdG9yKSA6ICR0LmNoaWxkcmVuKCk7XG5cbiAgICAgICAgaWYgKCFpZCkge1xuICAgICAgICAgIGlkID0gJ2JpZ3RleHQtaWQnICsgY291bnRlcisrO1xuICAgICAgICAgICR0LmF0dHIoJ2lkJywgaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMucmVzaXplKSB7XG4gICAgICAgICAgQmlnVGV4dC5iaW5kUmVzaXplKCdyZXNpemUuYmlndGV4dC1ldmVudC0nICsgaWQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIFRPRE8gb25seSBjYWxsIHRoaXMgaWYgdGhlIHdpZHRoIGhhcyBjaGFuZ2VkLlxuICAgICAgICAgICAgQmlnVGV4dC5qUXVlcnlNZXRob2QuY2FsbCgkKCcjJyArIGlkKSwgb3B0aW9ucyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBCaWdUZXh0LmNsZWFyQ3NzKGlkKTtcblxuICAgICAgICAkY2hpbGRyZW4uYWRkQ2xhc3MoZnVuY3Rpb24gKGxpbmVOdW1iZXIsIGNsYXNzTmFtZSkge1xuICAgICAgICAgIC8vIHJlbW92ZSBleGlzdGluZyBsaW5lIGNsYXNzZXMuXG4gICAgICAgICAgcmV0dXJuIFtjbGFzc05hbWUucmVwbGFjZShuZXcgUmVnRXhwKCdcXFxcYicgKyBCaWdUZXh0LkxJTkVfQ0xBU1NfUFJFRklYICsgJ1xcXFxkK1xcXFxiJyksICcnKSwgQmlnVGV4dC5MSU5FX0NMQVNTX1BSRUZJWCArIGxpbmVOdW1iZXJdLmpvaW4oJyAnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdmFyIHNpemVzID0gY2FsY3VsYXRlU2l6ZXMoJHQsICRjaGlsZHJlbiwgbWF4V2lkdGgsIG9wdGlvbnMubWF4Zm9udHNpemUsIG9wdGlvbnMubWluZm9udHNpemUpO1xuICAgICAgICAkaGVhZENhY2hlLmFwcGVuZChCaWdUZXh0LmdlbmVyYXRlQ3NzKGlkLCBzaXplcy5mb250U2l6ZXMsIHNpemVzLndvcmRTcGFjaW5ncywgc2l6ZXMubWluRm9udFNpemVzKSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcignYmlndGV4dDpjb21wbGV0ZScpO1xuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiB0ZXN0TGluZURpbWVuc2lvbnMoJGxpbmUsIG1heFdpZHRoLCBwcm9wZXJ0eSwgc2l6ZSwgaW50ZXJ2YWwsIHVuaXRzLCBwcmV2aW91c1dpZHRoKSB7XG4gICAgdmFyIHdpZHRoO1xuICAgIHByZXZpb3VzV2lkdGggPSB0eXBlb2YgcHJldmlvdXNXaWR0aCA9PT0gJ251bWJlcicgPyBwcmV2aW91c1dpZHRoIDogMDtcbiAgICAkbGluZS5jc3MocHJvcGVydHksIHNpemUgKyB1bml0cyk7XG5cbiAgICB3aWR0aCA9ICRsaW5lLndpZHRoKCk7XG5cbiAgICBpZiAod2lkdGggPj0gbWF4V2lkdGgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKHdpZHRoLCAnIHByZXZpb3VzOiAnICsgcHJldmlvdXNXaWR0aCwgcHJvcGVydHkgKyAnIGF0ICcgKyBpbnRlcnZhbCwgJ3ByaW9yOiAnICsgKHBhcnNlRmxvYXQoc2l6ZSkgLSBpbnRlcnZhbCksICduZXc6JyArIHBhcnNlRmxvYXQoc2l6ZSkpO1xuICAgICAgJGxpbmUuY3NzKHByb3BlcnR5LCAnJyk7XG5cbiAgICAgIGlmICh3aWR0aCA9PT0gbWF4V2lkdGgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtYXRjaDogJ2V4YWN0JyxcbiAgICAgICAgICBzaXplOiBwYXJzZUZsb2F0KChwYXJzZUZsb2F0KHNpemUpIC0gMC4xKS50b0ZpeGVkKDMpKVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBTaW5jZSB0aGlzIGlzIGFuIGVzdGltYXRlLCB3ZSBjYWxjdWxhdGUgaG93IGZhciBvdmVyIHRoZSB3aWR0aCB3ZSB3ZW50IHdpdGggdGhlIG5ldyB2YWx1ZS5cbiAgICAgIC8vIElmIHRoaXMgaXMgd29yZC1zcGFjaW5nIChvdXIgbGFzdCByZXNvcnQgZ3Vlc3MpIGFuZCB0aGUgb3ZlciBpcyBsZXNzIHRoYW4gdGhlIHVuZGVyLCB3ZSBrZWVwIHRoZSBoaWdoZXIgdmFsdWUuXG4gICAgICAvLyBPdGhlcndpc2UsIHdlIHJldmVydCB0byB0aGUgdW5kZXJlc3RpbWF0ZS5cbiAgICAgIHZhciB1bmRlciA9IG1heFdpZHRoIC0gcHJldmlvdXNXaWR0aCxcbiAgICAgICAgICBvdmVyID0gd2lkdGggLSBtYXhXaWR0aDtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWF0Y2g6ICdlc3RpbWF0ZScsXG4gICAgICAgIHNpemU6IHBhcnNlRmxvYXQoKHBhcnNlRmxvYXQoc2l6ZSkgLSAocHJvcGVydHkgPT09ICd3b3JkLXNwYWNpbmcnICYmIHByZXZpb3VzV2lkdGggJiYgb3ZlciA8IHVuZGVyID8gMCA6IGludGVydmFsKSkudG9GaXhlZCgzKSlcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHdpZHRoO1xuICB9XG5cbiAgZnVuY3Rpb24gY2FsY3VsYXRlU2l6ZXMoJHQsICRjaGlsZHJlbiwgbWF4V2lkdGgsIG1heEZvbnRTaXplLCBtaW5Gb250U2l6ZSkge1xuICAgIHZhciAkYyA9ICR0LmNsb25lKHRydWUpLmFkZENsYXNzKCdiaWd0ZXh0LWNsb25lZCcpLmNzcyh7XG4gICAgICBmb250RmFtaWx5OiAkdC5jc3MoJ2ZvbnQtZmFtaWx5JyksXG4gICAgICB0ZXh0VHJhbnNmb3JtOiAkdC5jc3MoJ3RleHQtdHJhbnNmb3JtJyksXG4gICAgICB3b3JkU3BhY2luZzogJHQuY3NzKCd3b3JkLXNwYWNpbmcnKSxcbiAgICAgIGxldHRlclNwYWNpbmc6ICR0LmNzcygnbGV0dGVyLXNwYWNpbmcnKSxcbiAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgbGVmdDogQmlnVGV4dC5ERUJVR19NT0RFID8gMCA6IC05OTk5LFxuICAgICAgdG9wOiBCaWdUZXh0LkRFQlVHX01PREUgPyAwIDogLTk5OTlcbiAgICB9KS5hcHBlbmRUbyhkb2N1bWVudC5ib2R5KTtcblxuICAgIC8vIGZvbnQtc2l6ZSBpc24ndCB0aGUgb25seSB0aGluZyB3ZSBjYW4gbW9kaWZ5LCB3ZSBjYW4gYWxzbyBtZXNzIHdpdGg6XG4gICAgLy8gd29yZC1zcGFjaW5nIGFuZCBsZXR0ZXItc3BhY2luZy4gV2ViS2l0IGRvZXMgbm90IHJlc3BlY3Qgc3VicGl4ZWxcbiAgICAvLyBsZXR0ZXItc3BhY2luZywgd29yZC1zcGFjaW5nLCBvciBmb250LXNpemUuXG4gICAgLy8gVE9ETyB0cnkgLXdlYmtpdC10cmFuc2Zvcm06IHNjYWxlKCkgYXMgYSB3b3JrYXJvdW5kLlxuICAgIHZhciBmb250U2l6ZXMgPSBbXSxcbiAgICAgICAgd29yZFNwYWNpbmdzID0gW10sXG4gICAgICAgIG1pbkZvbnRTaXplcyA9IFtdLFxuICAgICAgICByYXRpb3MgPSBbXTtcblxuICAgICRjaGlsZHJlbi5jc3MoJ2Zsb2F0JywgJ2xlZnQnKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciAkbGluZSA9ICQodGhpcyksXG5cbiAgICAgIC8vIFRPRE8gcmVwbGFjZSA4LCA0IHdpdGggYSBwcm9wb3J0aW9uYWwgc2l6ZSB0byB0aGUgY2FsY3VsYXRlZCBmb250LXNpemUuXG4gICAgICBpbnRlcnZhbHMgPSBCaWdUZXh0LnN1cHBvcnRzLndob2xlTnVtYmVyRm9udFNpemVPbmx5ID8gWzgsIDQsIDFdIDogWzgsIDQsIDEsIDAuMV0sXG4gICAgICAgICAgbGluZU1heCxcbiAgICAgICAgICBuZXdGb250U2l6ZTtcblxuICAgICAgaWYgKCRsaW5lLmhhc0NsYXNzKEJpZ1RleHQuRVhFTVBUX0NMQVNTKSkge1xuICAgICAgICBmb250U2l6ZXMucHVzaChudWxsKTtcbiAgICAgICAgcmF0aW9zLnB1c2gobnVsbCk7XG4gICAgICAgIG1pbkZvbnRTaXplcy5wdXNoKGZhbHNlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBUT0RPIHdlIGNhbiBjYWNoZSB0aGlzIHJhdGlvP1xuICAgICAgdmFyIGF1dG9HdWVzc1N1YnRyYWN0aW9uID0gMzIsXG4gICAgICAgICAgLy8gZm9udCBzaXplIGluIHB4XG4gICAgICBjdXJyZW50Rm9udFNpemUgPSBwYXJzZUZsb2F0KCRsaW5lLmNzcygnZm9udC1zaXplJykpLFxuICAgICAgICAgIHJhdGlvID0gKCRsaW5lLndpZHRoKCkgLyBjdXJyZW50Rm9udFNpemUpLnRvRml4ZWQoNik7XG5cbiAgICAgIG5ld0ZvbnRTaXplID0gcGFyc2VJbnQobWF4V2lkdGggLyByYXRpbywgMTApIC0gYXV0b0d1ZXNzU3VidHJhY3Rpb247XG5cbiAgICAgIG91dGVyOiBmb3IgKHZhciBtID0gMCwgbiA9IGludGVydmFscy5sZW5ndGg7IG0gPCBuOyBtKyspIHtcbiAgICAgICAgaW5uZXI6IGZvciAodmFyIGogPSAxLCBrID0gMTA7IGogPD0gazsgaisrKSB7XG4gICAgICAgICAgaWYgKG5ld0ZvbnRTaXplICsgaiAqIGludGVydmFsc1ttXSA+IG1heEZvbnRTaXplKSB7XG4gICAgICAgICAgICBuZXdGb250U2l6ZSA9IG1heEZvbnRTaXplO1xuICAgICAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGluZU1heCA9IHRlc3RMaW5lRGltZW5zaW9ucygkbGluZSwgbWF4V2lkdGgsICdmb250LXNpemUnLCBuZXdGb250U2l6ZSArIGogKiBpbnRlcnZhbHNbbV0sIGludGVydmFsc1ttXSwgJ3B4JywgbGluZU1heCk7XG4gICAgICAgICAgaWYgKHR5cGVvZiBsaW5lTWF4ICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgbmV3Rm9udFNpemUgPSBsaW5lTWF4LnNpemU7XG5cbiAgICAgICAgICAgIGlmIChsaW5lTWF4Lm1hdGNoID09PSAnZXhhY3QnKSB7XG4gICAgICAgICAgICAgIGJyZWFrIG91dGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWsgaW5uZXI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJhdGlvcy5wdXNoKG1heFdpZHRoIC8gbmV3Rm9udFNpemUpO1xuXG4gICAgICBpZiAobmV3Rm9udFNpemUgPiBtYXhGb250U2l6ZSkge1xuICAgICAgICBmb250U2l6ZXMucHVzaChtYXhGb250U2l6ZSk7XG4gICAgICAgIG1pbkZvbnRTaXplcy5wdXNoKGZhbHNlKTtcbiAgICAgIH0gZWxzZSBpZiAoISFtaW5Gb250U2l6ZSAmJiBuZXdGb250U2l6ZSA8IG1pbkZvbnRTaXplKSB7XG4gICAgICAgIGZvbnRTaXplcy5wdXNoKG1pbkZvbnRTaXplKTtcbiAgICAgICAgbWluRm9udFNpemVzLnB1c2godHJ1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb250U2l6ZXMucHVzaChuZXdGb250U2l6ZSk7XG4gICAgICAgIG1pbkZvbnRTaXplcy5wdXNoKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KS5lYWNoKGZ1bmN0aW9uIChsaW5lTnVtYmVyKSB7XG4gICAgICB2YXIgJGxpbmUgPSAkKHRoaXMpLFxuICAgICAgICAgIHdvcmRTcGFjaW5nID0gMCxcbiAgICAgICAgICBpbnRlcnZhbCA9IDEsXG4gICAgICAgICAgbWF4V29yZFNwYWNpbmc7XG5cbiAgICAgIGlmICgkbGluZS5oYXNDbGFzcyhCaWdUZXh0LkVYRU1QVF9DTEFTUykpIHtcbiAgICAgICAgd29yZFNwYWNpbmdzLnB1c2gobnVsbCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gbXVzdCByZS11c2UgZm9udC1zaXplLCBldmVuIHRob3VnaCBpdCB3YXMgcmVtb3ZlZCBhYm92ZS5cbiAgICAgICRsaW5lLmNzcygnZm9udC1zaXplJywgZm9udFNpemVzW2xpbmVOdW1iZXJdICsgJ3B4Jyk7XG5cbiAgICAgIGZvciAodmFyIG0gPSAxLCBuID0gMzsgbSA8IG47IG0gKz0gaW50ZXJ2YWwpIHtcbiAgICAgICAgbWF4V29yZFNwYWNpbmcgPSB0ZXN0TGluZURpbWVuc2lvbnMoJGxpbmUsIG1heFdpZHRoLCAnd29yZC1zcGFjaW5nJywgbSwgaW50ZXJ2YWwsICdweCcsIG1heFdvcmRTcGFjaW5nKTtcbiAgICAgICAgaWYgKHR5cGVvZiBtYXhXb3JkU3BhY2luZyAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICB3b3JkU3BhY2luZyA9IG1heFdvcmRTcGFjaW5nLnNpemU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgJGxpbmUuY3NzKCdmb250LXNpemUnLCAnJyk7XG4gICAgICB3b3JkU3BhY2luZ3MucHVzaCh3b3JkU3BhY2luZyk7XG4gICAgfSkucmVtb3ZlQXR0cignc3R5bGUnKTtcblxuICAgIGlmICghQmlnVGV4dC5ERUJVR19NT0RFKSB7XG4gICAgICAkYy5yZW1vdmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGMuY3NzKHtcbiAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAncmdiYSgyNTUsMjU1LDI1NSwuNCknXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZm9udFNpemVzOiBmb250U2l6ZXMsXG4gICAgICB3b3JkU3BhY2luZ3M6IHdvcmRTcGFjaW5ncyxcbiAgICAgIHJhdGlvczogcmF0aW9zLFxuICAgICAgbWluRm9udFNpemVzOiBtaW5Gb250U2l6ZXNcbiAgICB9O1xuICB9XG5cbiAgJC5mbi5iaWd0ZXh0ID0gQmlnVGV4dC5qUXVlcnlNZXRob2Q7XG4gIHdpbmRvdy5CaWdUZXh0ID0gQmlnVGV4dDtcbn0pKHVuZGVmaW5lZCwgalF1ZXJ5KTtcblxuJCgnI2JpZ3RleHQnKS5iaWd0ZXh0KCk7XG5cbmlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3dHZXREYXRhLmpzJykudGhlbihmdW5jdGlvbiAocmVnaXN0cmF0aW9uKSB7XG4gICAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgcmVnaXN0cmF0aW9uJywgcmVnaXN0cmF0aW9uKTtcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgIHRocm93IG5ldyBFcnJvcignU2VydmljZVdvcmtlciBlcnJvcjogJyArIGVycik7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBsb2FkRGF0YSgpIHtcbiAgdmFyIHd1cmwgPSAnaHR0cDovL2FwaS5iYXJ0Lmdvdi9hcGkvc3RuLmFzcHg/Y21kPXN0bnMma2V5PU1XOVMtRTdTTC0yNkRVLVZWOFYnO1xuICAkLmFqYXgoe1xuICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgdXJsOiB3dXJsLFxuICAgIGRhdGFUeXBlOiBcInhtbFwiLFxuICAgIHN1Y2Nlc3M6IHBhcnNlWG1sLFxuICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcigpIHtcbiAgICAgICQoXCIjcm91dGVzLWF0LXN0YXRpb24taGVhZGVyXCIpLmNzcygnY29sb3InLCAncmVkJykuaHRtbChcIllvdSBhcmUgb2ZmbGluZSFcIik7XG4gICAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLXZhbHVlc1wiKS5jc3MoJ2NvbG9yJywgJ3JlZCcpLmh0bWwoXCJZb3UgY2FuJ3QgZ2V0IHRoZSBhY3R1YWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIHlvdXIgdHJpcCwgYnV0IHlvdSBzdGlsbCBoYXZlIGEgY2hhbmNlIHRvIGNoZWsgdGhlIG9mZmxpbmUgc2NoZWR1bGUgZm9yIHRoZSBjaG9zZW4gc3RhdGlvblwiKTtcbiAgICB9XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHBhcnNlWG1sKHhtbCkge1xuICAgICQoXCIjc3RhdGlvbnMtbGlzdFwiKS5odG1sKFwiXCIpO1xuICAgICQoeG1sKS5maW5kKFwic3RhdGlvblwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICQoXCIjc3RhdGlvbnMtbGlzdFwiKS5hcHBlbmQoXCI8b3B0aW9uIHZhbHVlPSdcIiArICQodGhpcykuZmluZChcIm5hbWVcIikudGV4dCgpICsgXCInIGRhdGEtdmFsdWU9J1wiICsgJCh0aGlzKS5maW5kKFwiYWJiclwiKS50ZXh0KCkgKyBcIic+PC9vcHRpb24+XCIpO1xuICAgICAgJChcIiNzdGF0aW9ucy1saXN0MlwiKS5hcHBlbmQoXCI8b3B0aW9uIHZhbHVlPSdcIiArICQodGhpcykuZmluZChcIm5hbWVcIikudGV4dCgpICsgXCInIGRhdGEtdmFsdWU9J1wiICsgJCh0aGlzKS5maW5kKFwiYWJiclwiKS50ZXh0KCkgKyBcIic+PC9vcHRpb24+XCIpO1xuICAgIH0pO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gY2hvb3NlU3RhdGlvbigpIHtcbiAgdmFyIGNob3NlbiA9ICQoXCIjc3RhdGlvbnMtaW5wdXRcIikudmFsKCk7XG4gIHZhciBjdXJyZW50U3RhdGlvbiA9ICQoXCIjc3RhdGlvbnMtbGlzdCBvcHRpb25bdmFsdWU9J1wiICsgY2hvc2VuICsgXCInXVwiKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG4gIHZhciB3dXJsID0gJ2h0dHA6Ly9hcGkuYmFydC5nb3YvYXBpL3N0bi5hc3B4P2NtZD1zdG5pbmZvJmtleT1NVzlTLUU3U0wtMjZEVS1WVjhWJm9yaWc9JyArIGN1cnJlbnRTdGF0aW9uO1xuICAkLmFqYXgoe1xuICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgdXJsOiB3dXJsLFxuICAgIGRhdGFUeXBlOiBcInhtbFwiLFxuICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIHN1Y2Nlc3MoZGF0YSkge1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcbiAgICBjb21wbGV0ZTogcGFyc2VYbWwyLFxuICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcigpIHtcbiAgICAgICQoXCIjcm91dGVzLWF0LXN0YXRpb24taGVhZGVyXCIpLmNzcygnY29sb3InLCAncmVkJykuaHRtbChcIllvdSBhcmUgb2ZmbGluZSFcIik7XG4gICAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLXZhbHVlc1wiKS5jc3MoJ2NvbG9yJywgJ3JlZCcpLmh0bWwoXCJZb3UgY2FuJ3QgZ2V0IHRoZSBhY3R1YWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIHlvdXIgdHJpcCwgYnV0IHlvdSBzdGlsbCBoYXZlIGEgY2hhbmNlIHRvIGNoZWsgdGhlIG9mZmxpbmUgc2NoZWR1bGUgZm9yIHRoZSBjaG9zZW4gc3RhdGlvblwiKTtcbiAgICAgICQoXCIjYWxsLXNjaGVkdWxlLWNvbnRlbnRcIikuaHRtbChcIlwiKTtcbiAgICB9XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHBhcnNlWG1sMih4bWwpIHtcbiAgICAkKFwiI2Zvcm0tY29udGFpbmVyMlwiKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLXZhbHVlc1wiKS5odG1sKFwiXCIpO1xuICAgICQoXCIjcm91dGVzLWF0LXN0YXRpb24taGVhZGVyXCIpLmh0bWwoXCI8cD5DaG9vc2Ugcm91dGU8L3A+XCIpO1xuICAgICQoXCIjc3RhdGlvbnMtaW5wdXQyXCIpLnZhbChcIlwiKTtcbiAgICAkKFwiI2FsbC1zY2hlZHVsZS1jb250ZW50XCIpLmh0bWwoXCJcIik7XG4gICAgJChcIiNzY2hlZC1yZXN1bHRzXCIpLmh0bWwoXCJcIik7XG4gICAgdmFyIGEgPSAkKHhtbC5yZXNwb25zZVRleHQpLmZpbmQoXCJzdGF0aW9uXCIpLmZpbmQoXCJub3J0aF9yb3V0ZXNcIikuZmluZChcInJvdXRlXCIpLnRleHQoKTtcbiAgICB2YXIgYiA9ICQoeG1sLnJlc3BvbnNlVGV4dCkuZmluZChcInN0YXRpb25cIikuZmluZChcInNvdXRoX3JvdXRlc1wiKS5maW5kKFwicm91dGVcIikudGV4dCgpO1xuICAgIGEgPSBhLnJlcGxhY2UoL1xccy9nLCAnJyk7XG4gICAgYiA9IGIucmVwbGFjZSgvXFxzL2csICcnKTtcbiAgICB2YXIgblJvdXRlcyA9IGEuc3BsaXQoXCJST1VURVwiKS5zbGljZSgyKTtcbiAgICB2YXIgc1JvdXRlcyA9IGIuc3BsaXQoXCJST1VURVwiKS5zbGljZSgyKTtcbiAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLWhlYWRlclwiKS5odG1sKFwiUm91dGVzIGF0IHRoZSBzdGF0aW9uOlwiKS5jc3MoJ2NvbG9yJywgJ3doaXRlJyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuUm91dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLXZhbHVlc1wiKS5hcHBlbmQoXCI8ZGl2IGNsYXNzPSdjb2wteHMtNiBjb2wtc20tNiBjb2wtbWQtNSBjb2wtbGctNScgaWQ9J3JvdXRlXCIgKyBuUm91dGVzW2ldICsgXCInPjxiPjxhIG9uY2xpY2s9J2Nob29zZVJvdXRlKFwiICsgblJvdXRlc1tpXSArIFwiKTsnPlJvdXRlIFwiICsgblJvdXRlc1tpXSArIFwiPC9hPjwvYj48L2Rpdj5cIik7XG4gICAgfVxuICAgIGZvciAodmFyIGogPSAwOyBqIDwgc1JvdXRlcy5sZW5ndGg7IGorKykge1xuICAgICAgJChcIiNyb3V0ZXMtYXQtc3RhdGlvbi12YWx1ZXNcIikuYXBwZW5kKFwiPGRpdiBjbGFzcz0nY29sLXhzLTYgY29sLXNtLTYgY29sLW1kLTUgY29sLWxnLTUnIGlkPSdyb3V0ZVwiICsgc1JvdXRlc1tqXSArIFwiJz48Yj48YSBvbmNsaWNrPSdjaG9vc2VSb3V0ZShcIiArIHNSb3V0ZXNbal0gKyBcIik7Jz5Sb3V0ZSBcIiArIHNSb3V0ZXNbal0gKyBcIjwvYT48L2I+PC9kaXY+XCIpO1xuICAgIH1cbiAgfVxuXG4gICQuYWpheCh7XG4gICAgdHlwZTogXCJHRVRcIixcbiAgICB1cmw6IFwiaHR0cDovL2FwaS5iYXJ0Lmdvdi9hcGkvc2NoZWQuYXNweD9jbWQ9c3Ruc2NoZWQma2V5PU1XOVMtRTdTTC0yNkRVLVZWOFYmbD0xJm9yaWc9XCIgKyBjdXJyZW50U3RhdGlvbixcbiAgICBkYXRhVHlwZTogXCJ4bWxcIixcbiAgICBzdWNjZXNzOiAkKFwiI2FsbC1zY2hlZHVsZS1saW5rXCIpLmh0bWwoXCI8YnV0dG9uIHR5cGU9J2J1dHRvbicgY2xhc3M9J2J0biBidG4tcHJpbWFyeSBidG4tbGcgYnRuLWJsb2NrJyBpZD0nb2ZmbGluZS1zY2hlZCc+T2ZmbGluZSBzY2hlZHVsZSBmb3IgXCIgKyBjaG9zZW4gKyBcIjwvYnV0dG9uPlwiKSxcbiAgICBlcnJvcjogZnVuY3Rpb24gZXJyb3IoKSB7XG4gICAgICAkKFwiI2Zvcm0tY29udGFpbmVyMlwiKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgJChcIiNyb3V0ZXMtYXQtc3RhdGlvbi1oZWFkZXJcIikuY3NzKCdjb2xvcicsICdyZWQnKS5odG1sKFwiWW91IGFyZSBvZmZsaW5lIVwiKTtcbiAgICAgICQoXCIjcm91dGVzLWF0LXN0YXRpb24tdmFsdWVzXCIpLmNzcygnY29sb3InLCAncmVkJykuaHRtbChcIllvdSBjYW4ndCBnZXQgdGhlIGFjdHVhbCBpbmZvcm1hdGlvbiByZWdhcmRpbmcgeW91ciB0cmlwLCBidXQgeW91IHN0aWxsIGhhdmUgYSBjaGFuY2UgdG8gY2hlayB0aGUgb2ZmbGluZSBzY2hlZHVsZSBmb3IgdGhlIGNob3NlbiBzdGF0aW9uXCIpO1xuICAgICAgJChcIiNhbGwtc2NoZWR1bGUtY29udGVudFwiKS5odG1sKFwiXCIpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gY2hvb3NlUm91dGUoeCkge1xuICB2YXIgd3VybCA9ICdodHRwOi8vYXBpLmJhcnQuZ292L2FwaS9yb3V0ZS5hc3B4P2NtZD1yb3V0ZWluZm8ma2V5PU1XOVMtRTdTTC0yNkRVLVZWOFYmcm91dGU9JyArIHg7XG4gICQuYWpheCh7XG4gICAgdHlwZTogXCJHRVRcIixcbiAgICB1cmw6IHd1cmwsXG4gICAgZGF0YVR5cGU6IFwieG1sXCIsXG4gICAgc3VjY2VzczogcGFyc2VYbWwzLFxuICAgIGVycm9yOiBmdW5jdGlvbiBlcnJvcigpIHtcbiAgICAgICQoXCIjZm9ybS1jb250YWluZXIyXCIpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLWhlYWRlclwiKS5jc3MoJ2NvbG9yJywgJ3JlZCcpLmh0bWwoXCJZb3UgYXJlIG9mZmxpbmUhXCIpO1xuICAgICAgJChcIiNyb3V0ZXMtYXQtc3RhdGlvbi12YWx1ZXNcIikuY3NzKCdjb2xvcicsICdyZWQnKS5odG1sKFwiWW91IGNhbid0IGdldCB0aGUgYWN0dWFsIGluZm9ybWF0aW9uIHJlZ2FyZGluZyB5b3VyIHRyaXAsIGJ1dCB5b3Ugc3RpbGwgaGF2ZSBhIGNoYW5jZSB0byBjaGVrIHRoZSBvZmZsaW5lIHNjaGVkdWxlIGZvciB0aGUgY2hvc2VuIHN0YXRpb25cIik7XG4gICAgICAkKFwiI2FsbC1zY2hlZHVsZS1jb250ZW50XCIpLmh0bWwoXCJcIik7XG4gICAgfVxuICB9KTtcblxuICBmdW5jdGlvbiBwYXJzZVhtbDMoeG1sKSB7XG4gICAgJChcIiNyb3V0ZXMtYXQtc3RhdGlvbi1oZWFkZXJcIikuaHRtbChcIjxwPlNlbGVjdCB0aGUgZGVzdGluYXRpb24gYXQgdGhlIGNob3NlbiByb3V0ZTwvcD5cIikuY3NzKCdjb2xvcicsICd3aGl0ZScpO1xuICAgIHZhciBiID0gXCIjcm91dGVcIiArIHg7XG4gICAgdmFyIGEgPSAkKHhtbCkuZmluZChcInN0YXRpb25cIikudGV4dCgpO1xuICAgIGEgPSBhLm1hdGNoKC8uezR9L2cpO1xuICAgICQoXCIjYWxsLXNjaGVkdWxlLWNvbnRlbnRcIikuaHRtbChcIlwiKTtcbiAgICB2YXIgY2hvc2VuID0gJChcIiNzdGF0aW9ucy1pbnB1dFwiKS52YWwoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBvbmNsaWNrID0gXCJmaW5hbERlc3RpbmF0aW9uKCdcIiArIGFbaV0gKyBcIicpXCI7XG4gICAgICBpZiAoJChcIiNzdGF0aW9ucy1saXN0IG9wdGlvbltkYXRhLXZhbHVlPSdcIiArIGFbaV0gKyBcIiddXCIpLmF0dHIoJ3ZhbHVlJykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChhW2ldID09ICQoXCIjc3RhdGlvbnMtbGlzdCBvcHRpb25bdmFsdWU9J1wiICsgY2hvc2VuICsgXCInXVwiKS5hdHRyKCdkYXRhLXZhbHVlJykpIHtcbiAgICAgICAgICAkKGIpLmFwcGVuZChcIjxwIGNsYXNzPSd5b3UtYXJlLWhlcmUnPiBZb3UgYXJlIGhlcmU6IFwiICsgJChcIiNzdGF0aW9ucy1saXN0IG9wdGlvbltkYXRhLXZhbHVlPSdcIiArIGFbaV0gKyBcIiddXCIpLmF0dHIoJ3ZhbHVlJykgKyBcIjwvcD5cIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJChiKS5hcHBlbmQoXCI8cD48YSBvbmNsaWNrPVwiICsgb25jbGljayArIFwiOz5cIiArICQoXCIjc3RhdGlvbnMtbGlzdCBvcHRpb25bZGF0YS12YWx1ZT0nXCIgKyBhW2ldICsgXCInXVwiKS5hdHRyKCd2YWx1ZScpICsgXCI8L2E+PC9wPlwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGZpbmFsRGVzdGluYXRpb24oeHgpIHtcbiAgdmFyIGNob3NlbiA9ICQoXCIjc3RhdGlvbnMtaW5wdXRcIikudmFsKCk7XG4gIHZhciBvcmcgPSAkKFwiI3N0YXRpb25zLWxpc3Qgb3B0aW9uW3ZhbHVlPSdcIiArIGNob3NlbiArIFwiJ11cIikuYXR0cignZGF0YS12YWx1ZScpO1xuICB2YXIgd3VybCA9ICdodHRwOi8vYXBpLmJhcnQuZ292L2FwaS9zY2hlZC5hc3B4P2NtZD1hcnJpdmUmZGF0ZT1ub3cma2V5PU1XOVMtRTdTTC0yNkRVLVZWOFYmYj0wJmE9MyZvcmlnPScgKyBvcmcgKyAnJmRlc3Q9JyArIHh4O1xuICAkLmFqYXgoe1xuICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgdXJsOiB3dXJsLFxuICAgIGRhdGFUeXBlOiBcInhtbFwiLFxuICAgIHN1Y2Nlc3M6IHBhcnNlWG1sNCxcbiAgICBlcnJvcjogZnVuY3Rpb24gZXJyb3IoKSB7XG4gICAgICAkKFwiI2Zvcm0tY29udGFpbmVyMlwiKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgJChcIiNyb3V0ZXMtYXQtc3RhdGlvbi1oZWFkZXJcIikuY3NzKCdjb2xvcicsICdyZWQnKS5odG1sKFwiWW91IGFyZSBvZmZsaW5lIVwiKTtcbiAgICAgICQoXCIjcm91dGVzLWF0LXN0YXRpb24tdmFsdWVzXCIpLmNzcygnY29sb3InLCAncmVkJykuaHRtbChcIllvdSBjYW4ndCBnZXQgdGhlIGFjdHVhbCBpbmZvcm1hdGlvbiByZWdhcmRpbmcgeW91ciB0cmlwLCBidXQgeW91IHN0aWxsIGhhdmUgYSBjaGFuY2UgdG8gY2hlayB0aGUgb2ZmbGluZSBzY2hlZHVsZSBmb3IgdGhlIGNob3NlbiBzdGF0aW9uXCIpO1xuICAgICAgJChcIiNhbGwtc2NoZWR1bGUtY29udGVudFwiKS5odG1sKFwiXCIpO1xuICAgIH1cbiAgfSk7XG5cbiAgZnVuY3Rpb24gcGFyc2VYbWw0KHhtbCkge1xuICAgICQoXCIjc2NoZWQtcmVzdWx0c1wiKS5odG1sKFwiXCIpO1xuICAgICQoXCIjYWxsLXNjaGVkdWxlLWNvbnRlbnRcIikuaHRtbChcIlwiKTtcbiAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLXZhbHVlc1wiKS5odG1sKFwiXCIpO1xuICAgICQoXCIjcm91dGVzLWF0LXN0YXRpb24taGVhZGVyXCIpLmh0bWwoXCJcIik7XG4gICAgJChcIiNzY2hlZC1yZXN1bHRzXCIpLmFwcGVuZChcIjxoNCBjbGFzcz0nc3VnZ2VzdGVkVGltZSc+WW91IGNhbiBwaWNrIG9uZSBvZiB0aGUgZm9sbG93aW5nIHRyYWlucyB0byBcIiArICQoXCIjc3RhdGlvbnMtbGlzdCBvcHRpb25bZGF0YS12YWx1ZT0nXCIgKyB4eCArIFwiJ11cIikuYXR0cigndmFsdWUnKSArIFwiPC9oND5cIik7XG4gICAgJCh4bWwpLmZpbmQoXCJ0cmlwXCIpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGRlcFRpbWVBcnIgPSB0aGlzLmNoaWxkcmVuWzFdLm91dGVySFRNTC5zcGxpdChcIm9yaWdUaW1lTWluPVwiKTtcbiAgICAgIHZhciBkZXBUaW1lID0gZGVwVGltZUFyclsxXS5zbGljZSgxLCA5KTtcbiAgICAgIHZhciBhcnJUaW1lQXJyID0gdGhpcy5jaGlsZHJlblsxXS5vdXRlckhUTUwuc3BsaXQoXCJkZXN0VGltZU1pbj1cIik7XG4gICAgICB2YXIgYXJyVGltZSA9IGFyclRpbWVBcnJbMV0uc2xpY2UoMSwgOSk7XG4gICAgICBpZiAoZGVwVGltZVs3XSA9PSAnXCInKSB7XG4gICAgICAgIGRlcFRpbWUgPSBkZXBUaW1lLnNsaWNlKDAsIC0xKTtcbiAgICAgIH1cbiAgICAgIGlmIChhcnJUaW1lWzddID09ICdcIicpIHtcbiAgICAgICAgYXJyVGltZSA9IGFyclRpbWUuc2xpY2UoMCwgLTEpO1xuICAgICAgfVxuICAgICAgJChcIiNzY2hlZC1yZXN1bHRzXCIpLmFwcGVuZChcIjxwIGNsYXNzPSdzdWdnZXN0ZWRUaW1lJz5EZXBhcnR1cmU6IFwiICsgZGVwVGltZSArIFwiLCBhcnJpdmFsOiBcIiArIGFyclRpbWUgKyBcIjwvcD5cIik7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBmaW5hbERlc3RpbmF0aW9uMigpIHtcbiAgdmFyIGNob3NlbiA9ICQoXCIjc3RhdGlvbnMtaW5wdXRcIikudmFsKCk7XG4gIHZhciBvcmcgPSAkKFwiI3N0YXRpb25zLWxpc3Qgb3B0aW9uW3ZhbHVlPSdcIiArIGNob3NlbiArIFwiJ11cIikuYXR0cignZGF0YS12YWx1ZScpO1xuICB2YXIgY2hvc2VuMiA9ICQoXCIjc3RhdGlvbnMtaW5wdXQyXCIpLnZhbCgpO1xuICB2YXIgZHN0ID0gJChcIiNzdGF0aW9ucy1saXN0MiBvcHRpb25bdmFsdWU9J1wiICsgY2hvc2VuMiArIFwiJ11cIikuYXR0cignZGF0YS12YWx1ZScpO1xuICB2YXIgd3VybCA9ICdodHRwOi8vYXBpLmJhcnQuZ292L2FwaS9zY2hlZC5hc3B4P2NtZD1hcnJpdmUmZGF0ZT1ub3cma2V5PU1XOVMtRTdTTC0yNkRVLVZWOFYmYj0wJmE9MyZvcmlnPScgKyBvcmcgKyAnJmRlc3Q9JyArIGRzdDtcbiAgJC5hamF4KHtcbiAgICB0eXBlOiBcIkdFVFwiLFxuICAgIHVybDogd3VybCxcbiAgICBkYXRhVHlwZTogXCJ4bWxcIixcbiAgICBzdWNjZXNzOiBwYXJzZVhtbDUsXG4gICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKCkge1xuICAgICAgJChcIiNmb3JtLWNvbnRhaW5lcjJcIikuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICQoXCIjcm91dGVzLWF0LXN0YXRpb24taGVhZGVyXCIpLmNzcygnY29sb3InLCAncmVkJykuaHRtbChcIllvdSBhcmUgb2ZmbGluZSFcIik7XG4gICAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLXZhbHVlc1wiKS5jc3MoJ2NvbG9yJywgJ3JlZCcpLmh0bWwoXCJZb3UgY2FuJ3QgZ2V0IHRoZSBhY3R1YWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIHlvdXIgdHJpcCwgYnV0IHlvdSBzdGlsbCBoYXZlIGEgY2hhbmNlIHRvIGNoZWsgdGhlIG9mZmxpbmUgc2NoZWR1bGUgZm9yIHRoZSBjaG9zZW4gc3RhdGlvblwiKTtcbiAgICAgICQoXCIjYWxsLXNjaGVkdWxlLWNvbnRlbnRcIikuaHRtbChcIlwiKTtcbiAgICB9XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHBhcnNlWG1sNSh4bWwpIHtcbiAgICB2YXIgeHggPSAkKFwiI3N0YXRpb25zLWlucHV0MlwiKS52YWwoKTtcbiAgICAkKFwiI3NjaGVkLXJlc3VsdHNcIikuaHRtbChcIlwiKTtcbiAgICAkKFwiI2FsbC1zY2hlZHVsZS1jb250ZW50XCIpLmh0bWwoXCJcIik7XG4gICAgJChcIiNyb3V0ZXMtYXQtc3RhdGlvbi12YWx1ZXNcIikuaHRtbChcIlwiKTtcbiAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLWhlYWRlclwiKS5odG1sKFwiXCIpO1xuICAgICQoXCIjc2NoZWQtcmVzdWx0c1wiKS5hcHBlbmQoXCI8ZGl2IGNsYXNzPSdzdWdnZXN0ZWRUaW1lIGNvbC14cy0xMiBjb2wtc20tMTIgY29sLW1kLTEyIGNvbC1sZy0xMic+PGg0IGNsYXNzPSdzdWdnZXN0ZWRUaW1lJz5Zb3UgY2FuIHBpY2sgb25lIG9mIHRoZSBmb2xsb3dpbmcgdHJhaW5zIHRvIFwiICsgeHggKyBcIjwvaDQ+PC9kaXY+XCIpO1xuICAgICQoeG1sKS5maW5kKFwidHJpcFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBkZXBUaW1lQXJyID0gdGhpcy5jaGlsZHJlblsxXS5vdXRlckhUTUwuc3BsaXQoXCJvcmlnVGltZU1pbj1cIik7XG4gICAgICB2YXIgZGVwVGltZSA9IGRlcFRpbWVBcnJbMV0uc2xpY2UoMSwgOSk7XG4gICAgICB2YXIgYXJyVGltZUFyciA9IHRoaXMuY2hpbGRyZW5bMV0ub3V0ZXJIVE1MLnNwbGl0KFwiZGVzdFRpbWVNaW49XCIpO1xuICAgICAgdmFyIGFyclRpbWUgPSBhcnJUaW1lQXJyWzFdLnNsaWNlKDEsIDkpO1xuICAgICAgaWYgKGRlcFRpbWVbN10gPT0gJ1wiJykge1xuICAgICAgICBkZXBUaW1lID0gZGVwVGltZS5zbGljZSgwLCAtMSk7XG4gICAgICB9XG4gICAgICBpZiAoYXJyVGltZVs3XSA9PSAnXCInKSB7XG4gICAgICAgIGFyclRpbWUgPSBhcnJUaW1lLnNsaWNlKDAsIC0xKTtcbiAgICAgIH1cbiAgICAgICQoXCIjc2NoZWQtcmVzdWx0c1wiKS5hcHBlbmQoXCI8ZGl2IGNsYXNzPSdzdWdnZXN0ZWRUaW1lIGNvbC14cy0xMiBjb2wtc20tMTIgY29sLW1kLTEyIGNvbC1sZy0xMic+RGVwYXJ0dXJlOiBcIiArIGRlcFRpbWUgKyBcIiwgYXJyaXZhbDogXCIgKyBhcnJUaW1lICsgXCI8L2Rpdj5cIik7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBzaG93U2NoZWR1bGUoKSB7XG4gIHZhciBjaG9zZW4gPSAkKFwiI3N0YXRpb25zLWlucHV0XCIpLnZhbCgpO1xuICB2YXIgY3VycmVudFN0YXRpb24gPSAkKFwiI3N0YXRpb25zLWxpc3Qgb3B0aW9uW3ZhbHVlPSdcIiArIGNob3NlbiArIFwiJ11cIikuYXR0cignZGF0YS12YWx1ZScpO1xuICB2YXIgY3VycmVudFN0YXRpb25WYWwgPSAkKFwiI3N0YXRpb25zLWxpc3Qgb3B0aW9uW3ZhbHVlPSdcIiArIGNob3NlbiArIFwiJ11cIikuYXR0cigndmFsdWUnKTtcbiAgJC5hamF4KHtcbiAgICB0eXBlOiBcIkdFVFwiLFxuICAgIHVybDogXCJodHRwOi8vYXBpLmJhcnQuZ292L2FwaS9zY2hlZC5hc3B4P2NtZD1zdG5zY2hlZCZrZXk9TVc5Uy1FN1NMLTI2RFUtVlY4ViZsPTEmb3JpZz1cIiArIGN1cnJlbnRTdGF0aW9uLFxuICAgIGRhdGFUeXBlOiBcInhtbFwiLFxuICAgIHN1Y2Nlc3M6IHBhcnNlU2NoZWQsXG4gICAgZXJyb3I6IGZ1bmN0aW9uIGVycm9yKCkge1xuICAgICAgJChcIiNmb3JtLWNvbnRhaW5lcjJcIikuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICQoXCIjcm91dGVzLWF0LXN0YXRpb24taGVhZGVyXCIpLmNzcygnY29sb3InLCAncmVkJykuaHRtbChcIllvdSBhcmUgb2ZmbGluZSFcIik7XG4gICAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLXZhbHVlc1wiKS5jc3MoJ2NvbG9yJywgJ3JlZCcpLmh0bWwoXCJZb3UgY2FuJ3QgZ2V0IHRoZSBhY3R1YWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIHlvdXIgdHJpcCwgYnV0IHlvdSBzdGlsbCBoYXZlIGEgY2hhbmNlIHRvIGNoZWsgdGhlIG9mZmxpbmUgc2NoZWR1bGUgZm9yIHRoZSBjaG9zZW4gc3RhdGlvblwiKTtcbiAgICAgICQoXCIjYWxsLXNjaGVkdWxlLWNvbnRlbnRcIikuaHRtbChcIlwiKTtcbiAgICAgICQoXCIjYWxsLXNjaGVkdWxlLWNvbnRlbnRcIikuYXBwZW5kKFwiPGg0IGNsYXNzPSd0ZXh0LWNlbnRlcic+U29ycnksIHNjaGVkdWxlIHdhc24ndCBsb2FkZWQuIEhlcmUgaXMgcm91dGVzIG1hcC48L2g0PlwiKS5jc3MoJ2NvbG9yJywgJ3JlZCcpO1xuICAgICAgJChcIiNhbGwtc2NoZWR1bGUtY29udGVudFwiKS5hcHBlbmQoXCI8aW1nIGlkPSd0aGUtcm91dGVzLW1hcCcgc3JjPSdpbWcvbWFwLmdpZic+XCIpO1xuICAgIH1cbiAgfSk7XG4gIGZ1bmN0aW9uIHBhcnNlU2NoZWQoeG1sKSB7XG4gICAgJChcIiNyb3V0ZXMtYXQtc3RhdGlvbi1oZWFkZXJcIikuaHRtbChcIlwiKTtcbiAgICAkKFwiI3JvdXRlcy1hdC1zdGF0aW9uLXZhbHVlc1wiKS5odG1sKFwiXCIpO1xuICAgICQoXCIjYWxsLXNjaGVkdWxlLWNvbnRlbnRcIikuaHRtbChcIlwiKTtcbiAgICAkKFwiI3NjaGVkLXJlc3VsdHNcIikuaHRtbChcIlwiKTtcbiAgICB2YXIgY2hvc2VuID0gJChcIiNzdGF0aW9ucy1pbnB1dFwiKS52YWwoKTtcbiAgICB2YXIgY3VycmVudFN0YXRpb24gPSAkKFwiI3N0YXRpb25zLWxpc3Qgb3B0aW9uW3ZhbHVlPSdcIiArIGNob3NlbiArIFwiJ11cIikuYXR0cignZGF0YS12YWx1ZScpO1xuICAgICQoXCIjYWxsLXNjaGVkdWxlLWxpbmtcIikuaHRtbChcIjxidXR0b24gdHlwZT0nYnV0dG9uJyBjbGFzcz0nYnRuIGJ0bi1wcmltYXJ5IGJ0bi1sZyBidG4tYmxvY2snIGlkPSdvZmZsaW5lLXNjaGVkJz5PZmZsaW5lIHNjaGVkdWxlIGZvciBcIiArIGN1cnJlbnRTdGF0aW9uVmFsICsgXCI8L2J1dHRvbj5cIik7XG4gICAgdmFyIHRoZUxpc3QgPSB4bWwuY2hpbGRyZW5bMF0uaW5uZXJIVE1MO1xuICAgIHRoZUxpc3QgPSB0aGVMaXN0LnNwbGl0KFwiPGl0ZW0gbGluZT1cIikuc2xpY2UoMSk7XG4gICAgdmFyIG15QmlnVGFibGUgPSBcIjx0YWJsZSBjbGFzcz0ndGFibGUgdGFibGUtaG92ZXIgdGFibGUtcmVzcG9uc2l2ZSB0YWJsZS1zdHJpcGVkJyBpZD0nc2NoZWQtdGFibGUnPjx0aGVhZCBjbGFzcz0nY2VudGVyJz48dHIgY2xhc3M9J3Jvdyc+PHRoIGNsYXNzPSdjb2wteHMtMyBjb2wtc20tMyBjb2wtbWQtMyBjb2wtbGctMyc+Um91dGU8L3RoPjx0aCBjbGFzcz0nY29sLXhzLTMgY29sLXNtLTMgY29sLW1kLTMgY29sLWxnLTMnPkRlc3RpbmF0aW9uPC90aD48dGggY2xhc3M9J2NvbC14cy0zIGNvbC1zbS0zIGNvbC1tZC0zIGNvbC1sZy0zJz5EZXBhcnR1cmUgdGltZTwvdGg+PHRoIGNsYXNzPSdjb2wteHMtMyBjb2wtc20tMyBjb2wtbWQtMyBjb2wtbGctMyc+QXJyaXZhbCB0aW1lPC90aD48L3RyPjwvdGhlYWQ+PHRib2R5PlwiO1xuICAgIGZvciAodmFyIGggPSAwOyBoIDwgdGhlTGlzdC5sZW5ndGg7IGgrKykge1xuICAgICAgdmFyIGNvbHVtblJvdXRlID0gdGhlTGlzdFtoXS5zbGljZSg3LCA5KTtcbiAgICAgIGlmIChjb2x1bW5Sb3V0ZVsxXSA9PSAnXCInKSB7XG4gICAgICAgIGNvbHVtblJvdXRlID0gY29sdW1uUm91dGUuc2xpY2UoMCwgLTEpO1xuICAgICAgfVxuICAgICAgdmFyIGNvbHVtbkRlc3RBcnIgPSB0aGVMaXN0W2hdLnNwbGl0KFwidHJhaW5IZWFkU3RhdGlvbj1cIik7XG4gICAgICB2YXIgY29sdW1uRGVzdEFiciA9IGNvbHVtbkRlc3RBcnJbMV0uc2xpY2UoMSwgNSk7XG4gICAgICB2YXIgY29sdW1uRGVzdCA9ICQoXCIjc3RhdGlvbnMtbGlzdCBvcHRpb25bZGF0YS12YWx1ZT0nXCIgKyBjb2x1bW5EZXN0QWJyICsgXCInXVwiKS5hdHRyKCd2YWx1ZScpO1xuICAgICAgdmFyIGNvbHVtblN0YXJ0RGVwQXJyID0gdGhlTGlzdFtoXS5zcGxpdChcIm9yaWdUaW1lPVwiKTtcbiAgICAgIHZhciBjb2x1bW5TdGFydERlcCA9IGNvbHVtblN0YXJ0RGVwQXJyWzFdLnNsaWNlKDEsIDkpO1xuICAgICAgaWYgKGNvbHVtblN0YXJ0RGVwWzddID09ICdcIicpIHtcbiAgICAgICAgY29sdW1uU3RhcnREZXAgPSBjb2x1bW5TdGFydERlcC5zbGljZSgwLCAtMSk7XG4gICAgICB9XG4gICAgICB2YXIgY29sdW1uRmluYWxBcnJBcnIgPSB0aGVMaXN0W2hdLnNwbGl0KFwiZGVzdFRpbWU9XCIpO1xuICAgICAgdmFyIGNvbHVtbkZpbmFsQXJyID0gY29sdW1uRmluYWxBcnJBcnJbMV0uc2xpY2UoMSwgOSk7XG4gICAgICBpZiAoY29sdW1uRmluYWxBcnJbN10gPT0gJ1wiJykge1xuICAgICAgICBjb2x1bW5GaW5hbEFyciA9IGNvbHVtbkZpbmFsQXJyLnNsaWNlKDAsIC0xKTtcbiAgICAgIH1cbiAgICAgIG15QmlnVGFibGUgPSBteUJpZ1RhYmxlICsgXCI8dHIgY2xhc3M9J3Jvdyc+PHRkIGNsYXNzPSdjb2wteHMtMyBjb2wtc20tMyBjb2wtbWQtMyBjb2wtbGctMyc+XCIgKyBjb2x1bW5Sb3V0ZSArIFwiPC90ZD48dGQgY2xhc3M9J2NvbC14cy0zIGNvbC1zbS0zIGNvbC1tZC0zIGNvbC1sZy0zJz5cIiArIGNvbHVtbkRlc3QgKyBcIjwvdGQ+PHRkIGNsYXNzPSdjb2wteHMtMyBjb2wtc20tMyBjb2wtbWQtMyBjb2wtbGctMyc+XCIgKyBjb2x1bW5TdGFydERlcCArIFwiPC90ZD48dGQgY2xhc3M9J2NvbC14cy0zIGNvbC1zbS0zIGNvbC1tZC0zIGNvbC1sZy0zJz5cIiArIGNvbHVtbkZpbmFsQXJyICsgXCI8L3RkPjwvdHI+XCI7XG4gICAgfVxuICAgIG15QmlnVGFibGUgPSBteUJpZ1RhYmxlICsgXCI8L3Rib2R5PjwvdGFibGU+XCI7XG4gICAgJChcIiNhbGwtc2NoZWR1bGUtY29udGVudFwiKS5hcHBlbmQobXlCaWdUYWJsZSk7XG4gIH1cbn1cblxuJCgnI2Zvcm0tY29udGFpbmVyJykuc3VibWl0KGNob29zZVN0YXRpb24pO1xuJCgnI2Zvcm0tY29udGFpbmVyMicpLnN1Ym1pdChmaW5hbERlc3RpbmF0aW9uMik7XG4kKCcjYWxsLXNjaGVkdWxlLWxpbmsnKS5jbGljayhzaG93U2NoZWR1bGUpO1xuLy8tIGVuZGluamVjdFxuLy8tIGluamVjdDpwbHVnaW5zXG5cbi8vLSBlbmRpbmplY3QiXSwiZmlsZSI6Im1haW4uanMifQ==
